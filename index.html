<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DATA PELANGGAN LAUNDRY</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background-color: #f4f4f4;
  }
  .container {
    width: 80%;
    margin: 50px auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  h1 {
    text-align: center;
    color: #333;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #000;
    padding: 12px;
    text-align: center;
  }
  th {
    background-color: #3efa41;
  }
  .delete-button {
    background-color: red;
    color: white;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 5px;
  }
  .delete-button:hover {
    background-color: darkred;
  }
  .error-message {
    color: red;
    font-weight: bold;
    text-align: center;
  }
</style>
</head>
<body>
<div class="container">
  <h1>Data Pelanggan Laundry</h1>
  <div class="error-message" id="error-message" style="display:none;">
    Failed to delete data. Please check the console for more details.
  </div>
  <table id="laundryTable">
    <thead>
      <tr>
        <th>No</th>
        <th>Tanggal</th>
        <th>Nama</th>
        <th>Harga</th>
        <th>Jumlah</th>
        <th>Berat</th>
        <th>Layanan</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody>
      <!-- data akan dimuat di sini -->
    </tbody>
  </table>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  const apiURL = "https://esp-api-proje.vercel.app/api/data"; // ganti sesuai URL Vercel kamu

  function formatCurrency(value) {
    return value ? value.toLocaleString('id-ID') : 'N/A';
  }

  function loadData() {
    $.get(apiURL, function(data) {
      const tbody = $('#laundryTable tbody');
      tbody.empty();

      if (Array.isArray(data) && data.length > 0) {
        data.forEach((item, idx) => {
          const row = `
            <tr>
              <td>${idx + 1}</td>
              <td>${item.tanggal || 'N/A'}</td>
              <td>${item.nama || 'N/A'}</td>
              <td>Rp ${formatCurrency(item.harga)}</td>
              <td>${item.jumlah || 'N/A'}</td>
              <td>${item.berat || 'N/A'} kg</td>
              <td>${item.layanan || 'N/A'}</td>
              <td><button class="delete-button" data-id="${item.id}">Delete</button></td>
            </tr>
          `;
          tbody.append(row);
        });
      } else {
        tbody.append('<tr><td colspan="8">Data tidak tersedia</td></tr>');
      }
      $('#error-message').hide();
    }).fail(function(xhr, status, error) {
      console.error('Error loading data:', error);
      $('#error-message').show();
    });
  }

  $('#laundryTable').on('click', '.delete-button', function() {
    if (!confirm('Yakin ingin menghapus data ini?')) return;

    const id = $(this).data('id');
    const row = $(this).closest('tr');

    $.ajax({
      url: `${apiURL}/${id}`,
      method: 'DELETE',
      success: function(response) {
        row.remove();
      },
      error: function(xhr, status, error) {
        console.error('Failed to delete data:', error);
        $('#error-message').show();
      }
    });
  });

  $(document).ready(loadData);
</script>
</body>
</html>
